<!DOCTYPE html>
<html>

<head>
    <title>Dnoak's page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="styles.css">
    </link>
    <link type="text/css" rel="stylesheet" href="productivStyles.css">
    </link>

</head>

<body>
    <nav>
       <ul>
				<li><a href="index.html">Home</a></li>
				<li><a href="">about</a></li>
				<li><a href="Blog.html">blog</a></li>
				<li><a href="projects.html">projects</a></li>
			</ul>
    </nav>

    <p>A simple productivity tool: Track time spent doing constructive things and deduct from it while doing
        recreational things. I'd like to expand on this at some point. Maybe add a login flow and hook it up to
        a database so that users can track their time on multiple devices.
    </p>
    <h6>Current Limitations:</h6>
    <p> This whole thing leans on one cookie. Users can easily cheat it. As outlined above, this is limited to 
        tracking per device. Not great in the age of smartphones and laptops. Oh well... Also could have separated
        ui and logic a little better.
    </p>


    <ul>
        <li>
            <h1 id="clock" class="clock">00:30:00</h1>
        </li>
        <li>
            <button onclick="productiveClick()" class="greenButton">productive</button>
            <button onclick="destructiveClick()" class="redButton">destructive</button>
        </li>
        <li>
            <button id="goButton" onclick="goClick()" class="greenButton">go</button>
            <button id="stopButton" onclick="stopClick()" disabled="true" class="redButton">stop</button>
        </li>
    </ul>
    <script>
        var cookies = document.cookie;
        var tickID = 0;
        var plusOrMinus = 1;
        window.onload = function () {
            console.log("Page loaded with cookies: " + cookies);
            //If the user does not have a totalTime cookie, initialize to the value in clock
            if (cookies == null || !cookies.includes("totalTime")) {
                document.cookie = "totalTime=" + document.getElementById("clock");
            }
            //else, initialize the clock to their cookie value. TODO: separate frontend and logic...
            else {
                cookies = cookies.split(";");
                totalTimeCookie = "";
                i = 0;
                while (totalTimeCookie == "") {
                    if (cookies[i].startsWith("totalTime")) {
                        totalTimeCookie = cookies[i];
                    }
                    else
                        i++;
                }
                document.getElementById("clock").innerText = totalTimeCookie.split('=')[1];
            }

            console.log(document.cookie);
        };
        function productiveClick() {
            console.log("Productive clicked");
            plusOrMinus = 1;
            document.getElementById("clock").style.backgroundColor="green";
        }
        function destructiveClick() {
            console.log("destructive Clicked");
            plusOrMinus = -1;
            document.getElementById("clock").style.backgroundColor="darkred";

        }
        function goClick() {
            tickID = setInterval(tick, 1000);
            document.getElementById("goButton").disabled = true;
            document.getElementById("stopButton").disabled = false;
            console.log("go clicked " + tickID);
        }
        function stopClick() {
            clearInterval(tickID);
            document.getElementById("goButton").disabled = false;
            document.getElementById("stopButton").disabled = true;
            console.log("stop clicked " + tickID);
        }
        /**
        * Turns clock strings formatted as HH:MM:SS into integer milliseconds
        * @param {number} clock the time string formatted as HH:MM:SS.
        * Note there is no support for anything above 99:99:99
        */
        function clockToMillis(clock) {
            var millis = 0;
            console.log("From c2m:" + clock);
            var clockParts = clock.split(":");
            console.log(clockParts);
            millis += clockParts[0] * 60 * 60 * 1000;
            millis += clockParts[1] * 60 * 1000;
            millis += clockParts[2] * 1000;
            console.log(millis);
            return millis;
        }
        /**
         * converts a number of milliseconds to human-readable HH:MM:SS string
         * @param {number} millis milliseconds to be converted to HH:MM:SS string
         */
        function millisToClock(millis) {
            originalMillis = millis;
            hours = Math.floor(millis / 3600000);
            //add leading zero to hours as needed
            hoursAsText = hours / 10 >= 1 ? '' + hours : '0' + hours;
            millis = millis % 3600000;
            minutes = Math.floor(millis / 60000);
            //add leading 0s to minutes
            minutesAsText = minutes / 10 >= 1 ? '' + minutes : '0' + minutes;
            millis = millis % 60000;
            seconds = Math.floor(millis / 1000);
            //leading zero to seconds 
            secondsAsText = seconds / 10 >= 1 ? '' + seconds : '0' + seconds
            output = (hoursAsText + ":" + minutesAsText + ":" + secondsAsText);
            console.log(output);
            return output;

        }
        function tick() {
            time = document.getElementById("clock").innerText;
            millis = clockToMillis(time);
            millis += plusOrMinus * 1000;
            time = millisToClock(millis);
            document.getElementById("clock").innerText = time;
            document.cookie = ("totalTime=" + time);
        }
    </script>
</body>


</html>